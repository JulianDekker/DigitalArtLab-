{% extends '::base.html.twig' %}

{% block body -%}
    <div class="content-container">
        <h2 class="h2">Statistieken</h2>
        {% set totaltransactionup = 0 %}
        {% set totaltransactiondown = 0 %}
        {% for transaction in transactions %}
            {% if transaction.amount > 0 %}
                {% set totaltransactionup = totaltransactionup + transaction.amount %}
            {% elseif transaction.amount < 0 %}
                {% set totaltransactiondown = totaltransactiondown + transaction.amount %}
            {% endif %}
        {% endfor %}
        <div class="stat">
            <h2>Totaal opgewaardeerd</h2>
            {{ totaltransactionup }}
            <h2>Totaal afgeschreven</h2>
            {{ totaltransactiondown }}
        </div>
        <div class="stat">
            <h2>Uren totaal</h2>
            {{ totaaluren }}
            <h2>Gemiddelde sessieduur</h2>

            {% set sumratingsH = '0' %}
            {% set sumratingsi = '0' %}
            {% set sumratingss = '0' %}
            {% for checkin in checkins %}
                {% if checkin.sessionduration %}
                    {% set sumratingsH = sumratingsH + checkin.sessionduration|date('H') / loop.length %}
                    {% set sumratingsi = sumratingsi + checkin.sessionduration|date('i') / loop.length %}
                    {% set sumratingss = sumratingss + checkin.sessionduration|date('s') / loop.length %}
                {% endif %}
            {% endfor %}
            {% set sumratingshl = (sumratingsH - sumratingsH|round(0, 'floor')) *60 %}
            {% set sumratingsi = sumratingsi + sumratingshl %}
            {%  if sumratingsi > 60 %}
                {% set sumratingsi = sumratingsi / 60 %}
                {% set sumratingsH = sumratingsH + sumratingsi|round(0, 'floor') %}
                {% set sumratingsi = (sumratingsi - sumratingsi|round(0, 'floor')) *60 %}
            {% endif %}
            {% set sumratingsil = (sumratingsi - sumratingsi|round(0, 'floor')) *60 %}
            {% set sumratingss = sumratingss + sumratingsil %}
            {%  if sumratingss > 60 %}
                {% set sumratingss = sumratingss / 60 %}
                {% set sumratingsi = sumratingsi + sumratingss|round(0, 'floor') %}
                {% set sumratingss = (sumratingss - sumratingss|round(0, 'floor')) *60 %}
            {% endif %}
            <p>{{  sumratingsH|round(0, 'floor') }}:{{  "%02d"|format(sumratingsi|round(0, 'floor')) }}:{{  "%02d"|format(sumratingss|round)  }}</p>


        </div>
        <div id="checkin_users" ></div>
        <div id="created_users" ></div>
        <div id="transactions_day" ></div>
        <div class="btn-fill admin_button_container">
            <a href="{{ path('admin') }}" class="button">Terug naar dashboard</a>
        </div>
        <div class="clear"></div>
    </div>
    <script type="text/javascript">
        window.onload = function () {
            var chart = new CanvasJS.Chart("checkin_users", {

                title:{
                    text: "Aanmeldingen per dag"
                },
                data: [//array of dataSeries
                    { //dataSeries object

                        /*** Change type "column" to "bar", "area", "line" or "pie"***/
                        type: "line",
                        yValueFormatString:"# Sessie('s)",
                        dataPoints: [
                            {% for key,sessions in groupsessions %}
                            { label: "{{ key }}", y: {{ sessions }} },
                            {% endfor %}
                        ]
                    }
                ]
            });

            chart.render();

            var chart2 = new CanvasJS.Chart("created_users", {

                title:{
                    text: "Nieuwe gebruikers per dag"
                },
                data: [//array of dataSeries
                    { //dataSeries object

                        /*** Change type "column" to "bar", "area", "line" or "pie"***/
                        type: "line",
                        yValueFormatString:"# Nieuwe gebruiker('s)",
                        dataPoints: [
                            {% for key,users in createdusers %}
                            { label: "{{ key }}", y: {{ users }} },
                            {% endfor %}
                        ]
                    }
                ]
            });

            chart2.render();

            var chart3 = new CanvasJS.Chart("transactions_day", {
                title:{
                    text: "Transacties per dag"
                },

                data: [  //array of dataSeries
                    { //dataSeries - first quarter
                        /*** Change type "column" to "bar", "area", "line" or "pie"***/
                        type: "line",
                        yValueFormatString:"# Opgewaardeerd",
                        name: "Opgewaardeerd",
                        showInLegend: true,
                        dataPoints: [
                            {% for transactions in grouptransactionsup %}
                                {% for key,values in transactions %}
                                    { label: "{{ key }}", y: {{ values }} },
                                {% endfor %}
                            {% endfor %}
                        ]
                    },

                    { //dataSeries - second quarter

                        type: "line",
                        yValueFormatString:"# Afgeschreven",
                        name: "Afgeschreven",
                        showInLegend: true,
                        dataPoints: [
                            {% for transactions in grouptransactionsdown %}
                                {% for key,values in transactions %}
                                    { label: "{{ key }}", y: {{ values }} },
                                {% endfor %}
                            {% endfor %}
                        ]
                    }
                ],

            });

            chart3.render();

        }
    </script>
{% endblock %}